<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/app/api/sandbox/delete/route.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/app/api/sandbox/delete/route.ts" />
              <option name="updatedContent" value="/**&#10; * API Route: /api/sandbox/delete&#10; * Deletes a file or directory in sandbox&#10; */&#10;&#10;import { NextRequest, NextResponse } from 'next/server';&#10;import { getSettings } from '@/lib/db';&#10;&#10;export const dynamic = 'force-dynamic';&#10;&#10;/**&#10; * POST /api/sandbox/delete&#10; * Body: { path: string }&#10; */&#10;export async function POST(request: NextRequest) {&#10;  console.log(`[API/sandbox/delete] POST /api/sandbox/delete`);&#10;&#10;  try {&#10;    let body;&#10;    try {&#10;      body = await request.json();&#10;    } catch (parseError) {&#10;      return NextResponse.json(&#10;        { ok: false, error: 'Invalid JSON body' },&#10;        { status: 400 }&#10;      );&#10;    }&#10;&#10;    const { path } = body;&#10;&#10;    if (!path) {&#10;      return NextResponse.json(&#10;        { ok: false, error: 'Missing path parameter' },&#10;        { status: 400 }&#10;      );&#10;    }&#10;&#10;    console.log(`[API/sandbox/delete] path=${path}`);&#10;&#10;    const settings = await getSettings();&#10;    const runnerBase = settings.runnerUrl || process.env.RUNNER_BASE_URL;&#10;&#10;    if (!runnerBase) {&#10;      return NextResponse.json(&#10;        { ok: false, error: 'Runner URL not configured. Set it in Settings.' },&#10;        { status: 500 }&#10;      );&#10;    }&#10;&#10;    const runnerToken = settings.runnerToken || process.env.RUNNER_TOKEN || null;&#10;    const runnerUrl = `${runnerBase}/sandbox/delete`;&#10;&#10;    const headers: Record&lt;string, string&gt; = {&#10;      'Content-Type': 'application/json',&#10;    };&#10;    if (runnerToken) {&#10;      headers['x-runner-token'] = runnerToken;&#10;    }&#10;&#10;    const response = await fetch(runnerUrl, {&#10;      method: 'POST',&#10;      headers,&#10;      body: JSON.stringify({ path }),&#10;      signal: AbortSignal.timeout(10000),&#10;    });&#10;&#10;    const text = await response.text();&#10;    &#10;    let runnerJson;&#10;    try {&#10;      runnerJson = JSON.parse(text);&#10;    } catch (parseError) {&#10;      return NextResponse.json(&#10;        { ok: false, error: 'Runner returned invalid JSON' },&#10;        { status: 502 }&#10;      );&#10;    }&#10;&#10;    if (!response.ok || runnerJson.ok === false) {&#10;      const errorMsg = runnerJson.error || `Runner failed with status ${response.status}`;&#10;      return NextResponse.json(&#10;        { ok: false, error: errorMsg },&#10;        { status: 502 }&#10;      );&#10;    }&#10;&#10;    console.log(`[API/sandbox/delete] Success: deleted ${path}`);&#10;&#10;    return NextResponse.json(runnerJson);&#10;&#10;  } catch (error: any) {&#10;    console.error('[API/sandbox/delete] Error:', error.message);&#10;    return NextResponse.json(&#10;      { ok: false, error: 'Internal server error' },&#10;      { status: 500 }&#10;    );&#10;  }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>